<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="paperformat_product_batch_label" model="report.paperformat">
        <field name="name">Format Inventory Label SKU</field>
        <field name="default" eval="False"/>
        <field name="format">custom</field>
        <field name="page_height">48</field>
        <field name="page_width">100</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">0</field>
        <field name="margin_bottom">0</field>
        <field name="margin_left">0</field>
        <field name="margin_right">0</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">0</field>
        <field name="dpi">75</field>
    </record>

    <template id="product_batch_label_raw_material_report_document">
        <div class="row" style="padding:0pt; margin:0pt;">
            <table style="width: 285pt; padding:0pt; margin:0pt;">
                <tr style="padding:0pt;">
                    <td colspan="2" style="padding:0pt;">
                        <span style="font-size:12pt; margin-bottom:0pt;margin-top:0pt;" align="left">
                            <b>RM Common Name:</b>
                            <t t-if="doc.product_id.name">
                                <t t-if="len(doc.product_id.name) > 25">
                                    <t t-esc="doc.product_id.name[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.product_id.name"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td colspan="2" style="width:60mm;" align="left" valign="center">
                        <span style="font-size:9pt;margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>INCI Name of RM: </b>
                            <t t-if="doc.product_id.inci_name">
                                <t t-if="len(doc.product_id.inci_name) > 25">
                                    <t t-esc="doc.product_id.inci_name[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.product_id.inci_name"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td style="width:60mm;" align="left" valign="center">
                        <span style="font-size:12pt; margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>MySM SKU Nr: </b>
                            <t t-if="doc.product_id.default_code">
                                <t t-if="len(doc.product_id.default_code) > 20">
                                    <t t-esc="doc.product_id.default_code[:20]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.product_id.default_code"/>
                                </t>
                            </t>
                        </span>
                    </td>
                    <td rowspan="6" style="width:40mm; " align="right" valign="top">
                        <img t-if="doc.product_id" t-att-src="image_data_uri(doc.generate_qr_code('stock.production.lot'))"
                            style="max-height:80pt;max-width:90%;position: absolute;z-index:-1;"
                            alt="Qr Code"/>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td style="width:60mm; " align="left" valign="center">
                        <span style="font-size:12pt; margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>MySM Batch Nr: </b>
                            <t t-if="doc.name">
                                <t t-if="len(doc.name) > 25">
                                    <t t-esc="doc.name[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.name"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td style="width:60mm; " align="left" valign="center">
                        <span style="font-size:9pt; margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>Ingredient Group: </b>
                            <t t-if="doc.product_id.categ_id">
                                <t t-if="len(doc.product_id.categ_id.name) > 25">
                                    <t t-esc="doc.product_id.categ_id.name[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.product_id.categ_id.name"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td style="width:60mm; " align="left" valign="center">
                        <span style="font-size:9pt; margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>RM Source: </b>
                            <t t-set="raw_material" t-value="doc.product_id.raw_material_source_id.name"/>
                            <t t-if="raw_material">
                                <t t-if="len(raw_material) > 25">
                                    <t t-esc="raw_material[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="raw_material"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
            </table>
        </div>
    </template>

    <template id="product_batch_label_packaging_report_document">
        <div class="row" style="padding:0pt; margin:0pt;">
            <table style="width: 100%; padding:0pt; margin:0pt;">
                <tr style="padding:0pt;">
                    <td colspan="2" style="padding:0pt;">
                        <span style="font-size:12pt; margin-bottom:0pt;margin-top:0pt;" align="left">
                            <b>PP Packaging: </b>
                            <t t-if="doc.product_id.name">
                                <t t-if="len(doc.product_id.name) > 25">
                                    <t t-esc="doc.product_id.name[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.product_id.name"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td colspan="2" style="width:60mm;" align="left" valign="center">
                        <span style="font-size:9pt;margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>Packaging Description: </b>
                            <t t-if="doc.product_id.product_description">
                                <t t-if="len(doc.product_id.product_description) > 25">
                                    <t t-esc="doc.product_id.product_description[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.product_id.product_description"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td style="width:60mm;" align="left" valign="center">
                        <span style="font-size:12pt; margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>MySM SKU Nr: </b>
                            <t t-if="doc.product_id.default_code">
                                <t t-if="len(doc.product_id.default_code) > 20">
                                    <t t-esc="doc.product_id.default_code[:20]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.product_id.default_code"/>
                                </t>
                            </t>
                        </span>
                    </td>
                    <td rowspan="6" style="width:40mm; " align="right" valign="top">
                        <img t-if="doc.product_id" t-att-src="image_data_uri(doc.generate_qr_code('stock.production.lot'))"
                            style="max-height:80pt;max-width:90%;position: absolute;z-index:-1;"
                            alt="Qr Code"/>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td style="width:60mm; " align="left" valign="center">
                        <span style="font-size:12pt; margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>MySM Batch Nr: </b>
                            <t t-if="doc.name">
                                <t t-if="len(doc.name) > 25">
                                    <t t-esc="doc.name[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="doc.name"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td style="width:60mm; " align="left" valign="center">
                        <span style="font-size:9pt; margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>Packaging supplier: </b>
                            <t t-set="last_supplier" t-value="doc._get_last_partner_id_stock_picking()"/>
                            <t t-if="last_supplier">
                                <t t-if="len(last_supplier.name) > 25">
                                    <t t-esc="last_supplier.name[:25]"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="last_supplier.name"/>
                                </t>
                            </t>
                        </span>
                    </td>
                </tr>
                <tr style="padding:0pt;">
                    <td style="width:60mm; " align="left" valign="center">
                        <span style="font-size:9pt; margin-bottom:0pt;margin-top:0pt; white-space: nowrap;">
                            <b>Stock ownership: </b>
                            <t t-set="stock_ownership" t-value="dict(doc.product_id.product_tmpl_id._fields['stock_ownership'].selection).get(doc.product_id.stock_ownership)"/>
                            <t t-esc="stock_ownership"/>
                        </span>
                    </td>
                </tr>
            </table>
        </div>
    </template>


    <template id="product_batch_label_report">
        <t t-call="web.basic_layout">
            <div class="page" style="padding:0pt; margin:0pt;">
                <t t-foreach="docs" t-as="doc">
                    <t t-if="doc.product_id">
                        <t t-if="doc.product_id.product_group in ['raw_material', 'raw_material_client']">
                            <t t-call="mysm_inventory.product_batch_label_raw_material_report_document"/>
                        </t>
                        <t t-elif="doc.product_id.product_group in ['packaging', 'packaging_client']">
                            <t t-call="mysm_inventory.product_batch_label_packaging_report_document"/>
                        </t>
                        <t t-else="">
                            <p class="text-center">Label not implemented yet</p>
                        </t>
                    </t>
                    <p style="page-break-after: always;"/>
                </t>
            </div>
        </t>
    </template>

    <record id="stock.action_report_lot_label" model="ir.actions.report">
        <field name="name">Lot/Serial Number (PDF)</field>
        <field name="model">stock.production.lot</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">mysm_inventory.product_batch_label_report</field>
        <field name="report_file">mysm_inventory.product_batch_label_report</field>
        <field name="print_report_name">'%s' % object.name</field>
        <field name="binding_model_id" ref="stock.model_stock_production_lot"/>
        <field name="paperformat_id" ref="mysm_inventory.paperformat_product_batch_label"/>
        <field name="binding_type">report</field>
    </record>

</odoo>
